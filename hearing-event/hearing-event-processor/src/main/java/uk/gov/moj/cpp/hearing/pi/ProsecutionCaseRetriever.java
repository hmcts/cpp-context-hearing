package uk.gov.moj.cpp.hearing.pi;import static javax.json.Json.createObjectBuilder;import static uk.gov.justice.services.core.annotation.Component.EVENT_PROCESSOR;import static uk.gov.justice.services.messaging.JsonEnvelope.envelopeFrom;import static uk.gov.justice.services.messaging.JsonEnvelope.metadataBuilder;import uk.gov.justice.services.core.annotation.ServiceComponent;import uk.gov.justice.services.core.requester.Requester;import uk.gov.justice.services.messaging.JsonEnvelope;import uk.gov.moj.cpp.hearing.query.view.response.hearingresponse.ProsecutionCaseResponse;import java.util.Optional;import java.util.UUID;import javax.enterprise.context.ApplicationScoped;import javax.inject.Inject;import javax.json.JsonObject;import org.slf4j.Logger;import org.slf4j.LoggerFactory;@ApplicationScopedpublic class ProsecutionCaseRetriever {    private static final Logger LOGGER = LoggerFactory.getLogger(ProsecutionCaseRetriever.class);    private static final String HEARING_QUERY_PROSECUTIONCASE_BY_HEARINGID = "hearing.prosecution-case-by-hearingid";    @ServiceComponent(EVENT_PROCESSOR)    @Inject    private Requester requester;    public Optional<ProsecutionCaseResponse> getProsecutionCaseForHearing(final UUID hearingId, final UUID hearingEventDefinitionId) {        LOGGER.info(" getProsecutionCaseForHearing hearing id {} ", hearingId);        final JsonObject query = createObjectBuilder()                .add("hearingId", String.valueOf(hearingId))                .add("hearingEventDefinitionId", String.valueOf(hearingEventDefinitionId))                .build();        final JsonEnvelope jsonEnvelope = envelopeFrom(                metadataBuilder()                        .withId(UUID.randomUUID())                        .withName(HEARING_QUERY_PROSECUTIONCASE_BY_HEARINGID)                        .build(),                query);        if (!jsonEnvelope.payloadAsJsonObject().isEmpty()) {            return Optional.of(requester.requestAsAdmin(jsonEnvelope, ProsecutionCaseResponse.class).payload());        }        return Optional.empty();    }}