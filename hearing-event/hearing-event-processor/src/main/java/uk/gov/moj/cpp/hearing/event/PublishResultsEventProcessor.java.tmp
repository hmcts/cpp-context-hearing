package uk.gov.moj.cpp.hearing.event;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import uk.gov.justice.services.common.converter.JsonObjectToObjectConverter;
import uk.gov.justice.services.common.converter.ObjectToJsonValueConverter;
import uk.gov.justice.services.core.annotation.Handles;
import uk.gov.justice.services.core.annotation.ServiceComponent;
import uk.gov.justice.services.messaging.JsonEnvelope;

import javax.inject.Inject;

import static uk.gov.justice.services.core.annotation.Component.EVENT_PROCESSOR;


public class PublishResultsEventProcessor {

    private static final Logger LOGGER = LoggerFactory.getLogger(PublishResultsEventProcessor.class);

    @Inject
    private JsonObjectToObjectConverter jsonObjectToObjectConverter;

    @Inject
    private ObjectToJsonValueConverter objectToJsonValueConverter;

    public void publishResults(final JsonEnvelope event) {
        LOGGER.info("-------------------------------------");
        System.out.println("here here here");
        LOGGER.info(event.toDebugStringPrettyPrint());


/*
        final ResultsPublished resultsPublished = this.jsonObjectToObjectConverter
                .convert(event.payloadAsJsonObject(), ResultsPublished.class);




        //decide what NOWS to generate
        //make a call for each NOW.





        ShareResultsMessage shareResultsMessage = ShareResultsMessage.shareResultsMessage()
                .setDefendants(
                        resultsPublished.getHearing().getDefendants().stream()
                                .map(defendant -> Defendant.defendant()
                                        .setHearing(
                                                Hearing.hearing()
                                                        .setId(resultsPublished.getHearing().getId())
                                                        .setHearingType(resultsPublished.getHearing().getType())
                                                        .setCourtCentreName(resultsPublished.getHearing().getCourtCentreName())
                                                        .setCourtCode("433")//hardcoded to 433 in original hmps resulting code.
                                                        .setDefenceName(
                                                                resultsPublished.getDefenceCounsels().isEmpty() ?
                                                                        "N/A" :
                                                                        format("%s %s %s",
                                                                                resultsPublished.getDefenceCounsels().get(0).getFirstName(),
                                                                                resultsPublished.getDefenceCounsels().get(0).getLastName(),
                                                                                resultsPublished.getDefenceCounsels().get(0).getStatus()
                                                                        )
                                                        )
                                                        .setJudgeName(
                                                                format("%s %s",
                                                                        resultsPublished.getHearing().getJudge().getFirstName(),
                                                                        resultsPublished.getHearing().getJudge().getLastName()
                                                                )
                                                        )
                                                        .setProsecutorName(
                                                                resultsPublished.getProsecutionCounsels().isEmpty() ?
                                                                        "N/A" :
                                                                        format("%s %s %s",
                                                                                resultsPublished.getProsecutionCounsels().get(0).getFirstName(),
                                                                                resultsPublished.getProsecutionCounsels().get(0).getLastName(),
                                                                                resultsPublished.getProsecutionCounsels().get(0).getStatus()
                                                                        )

                                                        )
                                                        .setStartDate(resultsPublished.getHearing().getStartDateTime().toLocalDate())
                                        )
                                        .setPerson(
                                                Person.person()
                                                        .setId(defendant.getId())
                                                        .setFirstName(defendant.getFirstName())
                                                        .setLastName(defendant.getLastName())
                                                        .setAddress(Address.address()
                                                                .setAddress1(defendant.getAddress().getAddress1())
                                                                .setAddress2(defendant.getAddress().getAddress2())
                                                                .setAddress3(defendant.getAddress().getAddress3())
                                                                .setAddress4(defendant.getAddress().getAddress4())
                                                                .setPostCode(defendant.getAddress().getPostCode())
                                                        )
                                                        .setDateOfBirth(defendant.getDateOfBirth())
                                        )
                                        //.setResultsLines()
                                )
                                .collect(Collectors.toList())
                );
                */

/*


{

defendants: [
{
  "resultLines": [
    {
      "id": "040a316f-a10b-44ee-aa8a-40722e2dda0e",
      "sharedTime": "2016-03-15T06:14:00Z",
      "caseId": "ab746921-d839-4867-bcf9-b41db8ebc852",
      "urn": "URN12345",
      "offenceId": "25d8cbfa-8dd0-494f-82f5-e58df2e53a33",
      "plea": {
        "pleaDate": "2016-06-07",
        "pleaValue": "Guilty"
      },
      "offenceTitle": "Wounding or inflicting grievous bodily harm with intent",
      "level": "OFFENCE",
      "resultLabel": "Imprisonment",
      "startDate": "2016-06-21",
      "endDate": "2017-08-01",
      "court": "A court",
      "courtRoom" : "Room 1",
      "clerkOfTheCourtId": "ab746921-d839-4867-bcf9-b41db8ebc852",
      "clerkOfTheCourtFirstName": "David",
      "clerkOfTheCourtLastName": "Walliams",
      "prompts": [
        {
          "label": "Imprisonment duration",
          "value": "1 year 6 months"
        },
        {
          "label": "Prison",
          "value": "Wormwood Scrubs"
        }
      ]
    }
  ],

}
]
}

 */


    }
}
